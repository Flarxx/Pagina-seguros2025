{% extends "nucleo/layout.html" %}
{% load static %}

{% block title %}Cotizar Seguro{% endblock %}

{% block content %}

<div class="container mx-auto mt-10 p-6 bg-white shadow rounded-xl max-w-2xl">

    <h1 class="text-3xl font-bold text-gray-700 mb-6">Cotizar Seguro</h1>

    <form id="formCotizar" class="space-y-4">

        <!-- Seleccionar producto -->
        <div>
            <label class="block text-gray-600 font-semibold">Producto:</label>
            <select id="producto" class="w-full border p-2 rounded">
                <option value="">Seleccione una p贸liza...</option>
                {% for p in productos %}
                <option value="{{ p.id }}">{{ p.tipo }} - {{ p.aseguradora }}</option>
                {% endfor %}
            </select>
        </div>

        <!-- Edad -->
        <div>
            <label class="block text-gray-600 font-semibold">Edad:</label>
            <input type="number" id="edad" min="18" max="80" value="30"
                   class="w-full border p-2 rounded">
        </div>

        <!-- Coberturas extras -->
        <div>
            <label class="block text-gray-600 font-semibold">Coberturas extra:</label>

            <label class="flex items-center gap-2 mt-2">
                <input type="checkbox" id="ambulancia" value="1">
                <span>Ambulancia</span>
            </label>

            <label class="flex items-center gap-2 mt-2">
                <input type="checkbox" id="hospitalizacion" value="1">
                <span>Hospitalizaci贸n</span>
            </label>
        </div>

        <!-- Bot贸n -->
        <button type="submit"
            class="w-full bg-blue-600 text-white py-2 rounded hover:bg-blue-700">
            Obtener Cotizaci贸n
        </button>
    </form>

    <!-- Resultado -->
    <div id="resultado" class="hidden mt-6 p-4 bg-green-100 border border-green-400 rounded">
        <h3 class="text-lg font-semibold">Monto estimado:</h3>
        <p class="text-2xl font-bold text-green-700" id="monto"></p>
    </div>

</div>

<script>
    document.getElementById("formCotizar").addEventListener("submit", function (e) {
        e.preventDefault();

        let producto = document.getElementById("producto").value;
        let edad = document.getElementById("edad").value;
        let ambulancia = document.getElementById("ambulancia").checked ? 1 : 0;
        let hospitalizacion = document.getElementById("hospitalizacion").checked ? 1 : 0;

        if (!producto) {
            alert("Seleccione un producto para cotizar");
            return;
        }

        fetch(`/polizas/cotizar/publico/${producto}/?edad=${edad}&ambulancia=${ambulancia}&hospitalizacion=${hospitalizacion}`)
            .then(response => response.json())
            .then(data => {
                document.getElementById("monto").textContent = data.monto_estimado + " USD";
                document.getElementById("resultado").classList.remove("hidden");
            });
    });
</script>

{% endblock %}
