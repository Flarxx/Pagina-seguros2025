{% extends 'polizas/cliente/layout.html' %}
{% load static %}

{% block title %}Dashboard de P贸lizas{% endblock %}

{% block content %}

<!-- T铆tulo -->
<h1 class="text-3xl font-bold text-gray-700 mb-4">Resumen Administrativo</h1>

<!-- Resumen -->
<p class="text-gray-600 mb-8">
  Aqu铆 puedes ver un resumen general de tus p贸lizas, pagos y reclamos.
</p>

<!--  Tarjetas peque帽as (6 en total) -->
<div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">

  <!-- Tarjeta 1 -->
  <div class="bg-white p-6 rounded-2xl shadow hover:shadow-lg transition border-t-4 border-purple-500 flex flex-col justify-between min-h-[220px]">
    <h2 class="text-lg font-semibold text-gray-700 mb-2">P贸lizas Activas</h2>
    <p class="text-3xl font-bold text-purple-700">{{ perfil.polizas_activas }}</p>
  </div>

  <!-- Tarjeta 2: Adquirir p贸liza -->
  <div class="bg-white p-6 rounded-2xl shadow hover:shadow-lg border-t-4 border-purple-500 flex flex-col justify-between min-h-[220px]">
    <h2 class="text-lg font-semibold mb-3 text-gray-700">Adquirir Nueva P贸liza</h2>
    <form action="{% url 'polizas:adquirir_poliza' %}" method="get" class="flex flex-col flex-1 justify-between">
      <select name="producto" class="border-none rounded-lg px-3 py-2 w-full text-gray-800 focus:ring focus:ring-purple-300">
        <option disabled selected>Selecciona tipo</option>
        {% for producto in productos_disponibles %}
          <option value="{{ producto.id }}">{{ producto.nombre }}</option>
        {% empty %}
          <option disabled>No hay p贸lizas disponibles</option>
        {% endfor %}
      </select>
      <button type="submit" class="mt-3 bg-purple-800 text-white py-2 px-4 rounded-lg hover:bg-purple-900 transition w-full font-semibold">
        Solicitar
      </button>
    </form>
  </div>

  <!-- Tarjeta 3: Reclamos recientes -->
<div class="bg-white p-6 rounded-2xl shadow hover:shadow-lg transition border-t-4 border-pink-500 flex flex-col justify-between min-h-[220px]">
  
  <div>
    <h2 class="text-2xl font-semibold text-pink-700 mb-4">Mis Reclamos Recientes</h2>

    <div id="reclamos-recientes" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
      {% for reclamo in reclamos_recientes %}
        <div class="bg-white p-4 rounded-xl shadow border-t-4 border-pink-500 flex flex-col justify-between min-h-[120px]">
          <h3 class="font-semibold text-pink-700">{{ reclamo.codigo }}</h3>
          <p class="text-gray-600 text-sm mb-1">{{ reclamo.poliza.get_tipo_display }}</p>
          <p class="text-gray-700 text-sm mb-2">{{ reclamo.descripcion|truncatechars:80 }}</p>
          <span class="text-xs font-medium text-white px-2 py-1 rounded 
                       {% if reclamo.estado == 'PENDIENTE' %}bg-yellow-500
                       {% elif reclamo.estado == 'EN_PROCESO' %}bg-blue-500
                       {% elif reclamo.estado == 'APROBADO' %}bg-green-500
                       {% elif reclamo.estado == 'RECHAZADO' %}bg-red-500
                       {% else %}bg-gray-500{% endif %}">
            {{ reclamo.get_estado_display }}
          </span>
          <a href="{% url 'reclamos:detalle' reclamo.pk %}" 
             class="mt-2 block text-sm text-pink-600 hover:underline">
             Ver detalle
          </a>
        </div>
      {% empty %}
        <p class="text-gray-500">No tienes reclamos recientes.</p>
      {% endfor %}
    </div>
  </div>

  <!-- Bot贸n abajo -->
  <a href="{% url 'reclamos:crear' %}" 
     class="mt-4 bg-pink-600 text-white py-2 px-4 rounded-lg hover:bg-pink-700 transition w-full font-semibold text-center">
     Nuevo Reclamo
  </a>

</div>


  <!-- Tarjeta 4: Pagos por confirmar -->
  <div class="bg-white p-6 rounded-2xl shadow hover:shadow-lg transition border-t-4 border-indigo-500 flex flex-col justify-between min-h-[220px]">
    <h2 class="text-lg font-semibold text-gray-700 mb-2">Pagos Por Confirmar</h2>
    <p class="text-3xl font-bold text-indigo-600">${{ perfil.pagos_pendientes|floatformat:2 }}</p>
  </div>

  <!-- Tarjeta 5: Cotizaciones pendientes -->
  <div class="bg-white p-6 rounded-2xl shadow hover:shadow-lg transition border-t-4 border-violet-500 flex flex-col justify-between min-h-[220px]">
    <h2 class="text-lg font-semibold text-gray-700 mb-2">Cotizaciones Pendientes</h2>
    <p class="text-3xl font-bold text-violet-600">{{ perfil.cotizaciones.count }}</p>
  </div>

  <!-- Tarjeta 6: Documentos pendientes -->
  <div class="bg-white p-6 rounded-2xl shadow hover:shadow-lg transition border-t-4 border-purple-400 flex flex-col justify-between min-h-[220px]">
    <h2 class="text-lg font-semibold text-gray-700 mb-2">Documentos Solicitados Pendientes</h2>
    <p class="text-3xl font-bold text-purple-500">
      {% if perfil.documento_pendiente %} 1 {% else %} 0 {% endif %}
    </p>
  </div>

</div>

<!--  Tarjetas grandes -->
<div class="grid grid-cols-1 lg:grid-cols-2 gap-6">

  <!-- Actividad CRM -->
  <div class="bg-gradient-to-br from-purple-50 to-purple-100 p-8 rounded-2xl shadow hover:shadow-lg transition h-64 flex flex-col justify-between border border-purple-200">
    <div>
      <h2 class="text-2xl font-semibold text-purple-800 mb-4">Actividad Reciente</h2>
      <div id="actividad-crm" class="text-gray-700 text-sm">
        Cargando actividad reciente...
      </div>
    </div>
    <a href="{% url 'crm:lista_interacciones' %}" class="mt-4 bg-purple-700 text-white py-2 px-4 rounded-lg hover:bg-purple-800 transition self-start">
      Ver detalles
    </a>
  </div>

  <!-- ltimos movimientos -->
  <div class="bg-gradient-to-br from-violet-50 to-indigo-100 p-8 rounded-2xl shadow hover:shadow-lg transition h-64 flex flex-col justify-between border border-indigo-200">
    <div>
      <h2 class="text-2xl font-semibold text-indigo-800 mb-4">ltimos movimientos</h2>
      <p class="text-gray-600">Revisa las 煤ltimas alertas del sistema, actualizaciones y mensajes internos.</p>
    </div>
    <button class="mt-4 bg-indigo-600 text-white py-2 px-4 rounded-lg hover:bg-indigo-700 transition self-start">
      Revisar
    </button>
  </div>

</div>

{% endblock %}

{% block extra_scripts %}

<!-- Variable GLOBAL con la URL del CRM -->
<script>
    const CRM_INTERACCIONES_URL = "{% url 'crm:interacciones_recientes_cliente' %}";
</script>

<!-- Cargar archivo JS -->
<script src="{% static 'js/cliente_crm.js' %}"></script>

{% endblock %}
