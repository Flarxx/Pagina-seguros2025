{% extends 'polizas/cliente/layout.html' %}
{% load static %}
{% block title %}Dashboard de P贸lizas{% endblock %}

{% block content %}

<!-- T铆tulo -->
<h1 class="text-3xl font-bold text-gray-700 mb-4">Resumen Administrativo</h1>

<!-- Resumen -->
<p class="text-gray-600 mb-8">
  Aqu铆 puedes ver un resumen general de tus p贸lizas, pagos y reclamos.
</p>

<!--  Tarjetas peque帽as (6 en total) -->
<div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">

  <!-- Tarjeta 1 -->
  <div class="bg-white p-6 rounded-2xl shadow hover:shadow-lg transition border-t-4 border-purple-500 flex flex-col justify-between min-h-[220px]">
    <h2 class="text-lg font-semibold text-gray-700 mb-2">P贸lizas Activas</h2>
    <p class="text-3xl font-bold text-purple-700">{{ perfil.polizas_activas }}</p>
  </div>

  <!-- Tarjeta 2: Adquirir p贸liza -->
  <div class="bg-white p-6 rounded-2xl shadow hover:shadow-lg border-t-4 border-purple-500 flex flex-col justify-between min-h-[220px]">
    <h2 class="text-lg font-semibold mb-3 text-gray-700">Adquirir Nueva P贸liza</h2>
    <form action="{% url 'polizas:adquirir_poliza' %}" method="get" class="flex flex-col flex-1 justify-between">
      <select name="producto" class="border-none rounded-lg px-3 py-2 w-full text-gray-800 focus:ring focus:ring-purple-300">
        <option disabled selected>Selecciona tipo</option>
        {% for producto in productos_disponibles %}
          <option value="{{ producto.id }}">{{ producto.nombre }}</option>
        {% empty %}
          <option disabled>No hay p贸lizas disponibles</option>
        {% endfor %}
      </select>
      <button type="submit" class="mt-3 bg-purple-800 text-white py-2 px-4 rounded-lg hover:bg-purple-900 transition w-full font-semibold">
        Solicitar
      </button>
    </form>
  </div>

  <!-- Reclamo resumido: mostrar solo p贸liza y motivo (1) -->
  <div class="bg-white p-6 rounded-2xl shadow border-t-4 border-pink-500 flex flex-col justify-between">
    <div>
      <h2 class="text-xl font-semibold text-pink-700 mb-3">ltimo Reclamo</h2>

      {% if reclamos_recientes %}
        {% with reclamo=reclamos_recientes.0 %}
          <!-- Mostrar solo: tipo de p贸liza y motivo (no acceder a atributos que no existen) -->
          <div class="flex items-start justify-between">
            <div>
              <p class="font-medium text-gray-800">
                {{ reclamo.poliza.get_tipo_display }}
              </p>
              <p class="text-sm text-gray-600 mt-1">
                {% if reclamo.motivo %}
                  {{ reclamo.motivo }}
                {% else %}
                  Sin motivo
                {% endif %}
              </p>
            </div>

            <span class="text-xs font-semibold px-2 py-1 rounded
                         {% if reclamo.estado == 'PENDIENTE' %}bg-yellow-500 text-black
                         {% elif reclamo.estado == 'EN_PROCESO' %}bg-blue-500 text-white
                         {% elif reclamo.estado == 'APROBADO' %}bg-green-500 text-white
                         {% elif reclamo.estado == 'RECHAZADO' %}bg-red-500 text-white
                         {% else %}bg-gray-500 text-white{% endif %}">
              {{ reclamo.get_estado_display }}
            </span>
          </div>

          <a href="{% url 'reclamos:detalle' reclamo.pk %}" class="mt-3 text-sm text-pink-600 hover:underline">Ver detalle</a>
        {% endwith %}
      {% else %}
        <p class="text-gray-500">No tienes reclamos recientes.</p>
      {% endif %}
    </div>

    <a href="{% url 'reclamos:crear' %}" class="mt-4 bg-pink-600 text-white py-2 px-4 rounded-lg hover:bg-pink-700 transition w-full font-semibold text-center">
      Nuevo Reclamo
    </a>
  </div>

  <!-- Tarjeta 4: Pagos por confirmar -->
  <div class="bg-white p-6 rounded-2xl shadow hover:shadow-lg transition border-t-4 border-indigo-500 flex flex-col justify-between min-h-[220px]">
    <h2 class="text-lg font-semibold text-gray-700 mb-2">Pagos Por Confirmar</h2>
    <p class="text-3xl font-bold text-indigo-600">${{ perfil.pagos_pendientes|floatformat:2 }}</p>
  </div>

  <!-- Tarjeta 5: Cotizaciones pendientes -->
  <div class="bg-white p-6 rounded-2xl shadow hover:shadow-lg transition border-t-4 border-violet-500 flex flex-col justify-between min-h-[220px]">
    <h2 class="text-lg font-semibold text-gray-700 mb-2">Cotizaciones Pendientes</h2>
    <p class="text-3xl font-bold text-violet-600">{{ perfil.cotizaciones.count }}</p>
  </div>

  <!-- Tarjeta 6: Documentos pendientes -->
  <div class="bg-white p-6 rounded-2xl shadow hover:shadow-lg transition border-t-4 border-purple-400 flex flex-col justify-between min-h-[220px]">
    <h2 class="text-lg font-semibold text-gray-700 mb-2">Documentos Solicitados Pendientes</h2>
    <p class="text-3xl font-bold text-purple-500">
      {% if perfil.documento_pendiente %} 1 {% else %} 0 {% endif %}
    </p>
  </div>

</div>

<!--  Tarjetas grandes -->
<div class="grid grid-cols-1 lg:grid-cols-2 gap-6">

  <!-- Actividad CRM -->
  <div class="bg-gradient-to-br from-purple-50 to-purple-100 p-8 rounded-2xl shadow hover:shadow-lg transition h-64 flex flex-col justify-between border border-purple-200">
    <div>
      <h2 class="text-2xl font-semibold text-purple-800 mb-4">Actividad Reciente</h2>
      <div id="actividad-crm" class="text-gray-700 text-sm">
        Cargando actividad reciente...
      </div>
    </div>
    <a href="{% url 'crm:lista_interacciones' %}" class="mt-4 bg-purple-700 text-white py-2 px-4 rounded-lg hover:bg-purple-800 transition self-start">
      Ver detalles
    </a>
  </div>

  <!-- ltimos movimientos -->
  <div class="bg-gradient-to-br from-violet-50 to-indigo-100 p-8 rounded-2xl shadow hover:shadow-lg transition h-64 flex flex-col justify-between border border-indigo-200">
    <div>
      <h2 class="text-2xl font-semibold text-indigo-800 mb-4">ltimos movimientos</h2>
      <p class="text-gray-600">Revisa las 煤ltimas alertas del sistema, actualizaciones y mensajes internos.</p>
    </div>
    <button class="mt-4 bg-indigo-600 text-white py-2 px-4 rounded-lg hover:bg-indigo-700 transition self-start">
      Revisar
    </button>
  </div>

</div>

{% endblock %}

{% block extra_scripts %}
<script>
    const CRM_INTERACCIONES_URL = "{% url 'crm:interacciones_recientes_cliente' %}";
</script>
<script src="{% static 'js/cliente_crm.js' %}"></script>
{% endblock %}